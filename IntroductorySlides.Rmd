---
title: "Session 3: Introduction into R and Econometrics"
author: "Dennis Rickert, MINES Paris-PSL University"
date: "2023-07-17"
output: 
  ioslides_presentation: 
#  html_document: 
#    number_sections: yes
#    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Overview of QEC9X01

-   Session 1: Oligopolistic Competition Refresher
-   Session 2: Oligopolistic Competition Refresher (cont.)
-   ***Session 3: Introduction into R and Econometrics***
-   ***Session 4: Introduction into R and Econometrics (cont.)***
-   Session 5: Estimation of Demand for Homogenous Goods
-   Session 6: Identification of Conduct and Collusion
-   Session 7: Econometrics Tutorial
-   Session 8: Product Differentiation, Multinomial Logit
-   Session 9: Differentiated Demand Workshop
-   Session 10: Market Structure and Entry
-   Session 11: Merger analysis
-   Session 12: Merger analysis - Empirical tutorial in R

## Overview of Session 3+4

What we do in Session 

-   Useful background information
-   Introduction into R and RStudio
-   Refresher of Econometrics: OLS, 2SLS, and endogeneity
-   How to estimate OLS and 2SLS in R
-   Practice exercise: estimation of linear regression and controlling for endogeneity

## Learning objectives of Session 3

- Familiarize with R and RStudio (no rocket science!)
- Become confident to use it 
- Understand why we need econometrics: to have causal effects instead of (potentially spurious) simple correlations
- Revisit the standard tools of econometrics: OLS, 2SLS
- Apply linear regressions in R without and with endogeneity 

# Introduction into R and RStudio

## Some basics in R...

To be able to use R, we need to understand: 

-   Surface of R and RStudio
-   Packages
-   Data (frames, import, export, missings)
-   Summary statistics and graphs

... which we learn in this class.

## Before using R and RStudio

-   R is a free software (GNU license)
    -   from: <http://www.r-project.org>
-   works best in combination with RStudio
    -   from: <https://posit.co/download/rstudio-desktop>
- Sign up for Github (for version control): <https://github.com/>
  - and download Github desktop: <https://desktop.github.com/>

## Useful links

Some introductory classes:
Using R for Introductory Econometrics: 
-   <http://www.urfie.net/>

If you need help:

-   Search engine: keyword + rstats
-   Forums:
    -   <http://stats.stackexchange.com/questions/tagged/R>
    -   <http://stackoverflow.com/questions/tagged/r>

## Getting started
Once you have installed everything, and signed up for the necessary:

- Go to <https://github.com/DennisRickert/IOIntroduction>, 
  - click on ‘fork’, then 'fork' again. 
  - then ‘code’, then ‘Open with Github desktop’
- Open RStudio on your computer, click on ‘new project’, then browse to the folder that you just cloned the git repo into in
Windows 
- probably: C:/Users/Username/Documents/GitHub/IOIntroduction)

## R Studio using R

The surface of RStudio consists of four windows

-   Script file (upper left)
    -   write reproducible code
-   Console (lower left)
    -   output is shown
-   Work space (upper right): environment, history, ...
    -   mainly shows your variables and data
-   Auxiliary (lower right): files, plots, packages, ...
    -   nice help function but otw rarely used

## Screenshot of surface of R Studio

```{r , echo=FALSE, out.width = "105%", fig.align = "center"}
knitr::include_graphics("Rstudio_surface.jpg")
```

## Console = similar to calculator:

- Simple operations
  - 2+4 or 5*3 or 3^4
- creating a  vector of 1 row and 5 columns. 
  - cbind(1:5) or c(1,2,3,4,5)
- creating a vector of 5 rows and 1 column
  - cbind(1:5)
- you can also use rbind() instead of c()
  - rbind(1:5)
- creating matrices. Alternative is function matrix()
  - cbind(1:5,1:5)
  - rbind(1:5,1:5)

## Functions
|Command    |Description                              |
|-----------|-----------------------------------------|
|sqrt(x)    |square root of value x                   |
|abs(x)     |absolute value of x                      |
|exp(x)     |exponential of x                         |
|log(x)     |natural logarithm of ln(x)               |
|round(x,s) |round x to s digits after decimal point  |

## Practical Excercise
1. Type in operations in console

# R scripts

## However, we prefer to use R scripts:

-   Do not type commands in console, collect in them in R-scripts
-   R-scripts: text file with file extension: .R
-   Advantages:
    -   Transparency
    -   Documentation
    -   Easy to correct mistakes
    -   Reproducibility
    -   You can run the code with one click when data changes

## Working with R-scripts

-   You can run scripts all at once, line-by-line, or in sections
    -   Mouse click: -\> run (all or selection)
    -   Menu: code -\> run (all or selection)
    -   ctrl + enter (all or selection)
-   You should comment the scripts.
    -   Each line starting with \# will be ignored by R
    -   Helps for documentation and to remember why you did what (for yourself and others)

## Practical Excercise
2. Create new R script

# Variables

## Variables: objects in other programs

- Variables can be populated with a variety of content, e.g.,
  - Numbers
  - Vectors
  - Matrices 
  - Data sets
  - Results from econometric estimations
  - ...

## Variables: create + operate 
- Create a new variable by assigning a value to it using “<-” 
    -   x <- sqrt(c(1,2,3,4,5))
-   Operate with variables
    -   x + 2
- RStudio  shows the variable in the “Environment” panel. 
- Print variable: type variable name and hit enter.

## Special functions for variables
|Command    |Description                                           |
|---------------|--------------------------------------------------|
|x[i]           |i-th value within vector x                        |
|length(x)      |length of vector x (number of elements)           |
|min(x)         |minimum of vector x (smallest element)            |
|max(x)         |maximum of vector x (largest element)             |
|sum(x)         |sum of elements in vector x                       |
|mean(x)        |mean of elements in vector x                      |
|sort(x)        |sort elements in vector x (from lowest to largest)|
|t(x)           |transpose vector x (exchange columns and rows)    |

## Functions also work with vector x 
- sqrt(x)
- abs(x)     
- exp(x)     
- log(x)     
- round(x,s) 

## Practical Excercise

3. Write + execute commands in 'my_first_Rscript.R'

# Data

## Create data (using data.frame)
- Data: collection of vectors into columns and rows 
  - similar to matrices and tables
- Vectors often are variables; 
  - the first row is the variable name x1,x2, …
- Data.frame(x1,x2,…) 
  - creates a data set consisting of vectors x1,x2,…
- Extract vector x1 from data frame df 
  - e.g., df\$x1

## Useful functions for data frames (df)
|Command    |Description                              |
|-----------|-----------------------------------------|
|names(df)  |variable names                           |
|nrow(df)   |number of rows (i.e., observations)      |
|ncol(df)   |number of columns (i.e., variable names) |
|head(df)   |first 6 rows of data frame               |
|tail(df)   |last 6 rows of data frame                |


## Brief digression: Packages

We use the package ***rio*** to import data

- we first see what packages are
- Packages extend the functionality of R
- To use the package ***rio*** (or others): 
  - Download for each computer using: Menu -> Tools -> Install Packages … 
  - or by typing install.packages(“rio”) and execute once
- Activate once per session and script using library(“rio”)

## Import data
- R can import several types of data sets: xls, csv, txt, .dta, …
- ***rio*** can detect the data type automatically
- We use the command import from the package ***rio***

## Practical Excercise

4. Import data and store in data frame df

## Missing Data (na = no available)
- mean(x1, na.rm=true) 
  - drop missing values from calculation of mean
- is.na(x1)
  - Check if missing values (na) exist in your data
- na.omit(df)
  - Create new data frame with all missing values (na) omitted

# Graphs

## Graphs
<blockquote>
***“The simple graph has brought more information to the data analyst’s mind than any other device***” John Tukey
<blockquote>

<br>

- Graphs are the most important toll for data analysis!!!
- We use ggplot2, with gg standing for “grammar of graphics”
- This shows the philosophy of the package
-  Google, Microsoft, New York Times create graphs like this
- Cheatsheet: 
  - Help -> Cheatsheets -> Data visualization with ggplot2

## Structure of the command ggplot
- Create new graph by using ggplot()
- Geometrical objects (“Geoms”) added using symbol “+”
- Each graph consists of geometrical objects (Geoms)
  - Lines: geom_line()
  - Dots: geom_point()
  - ... (see “Cheatsheet”)
- Each Geom requires
  - A dataset containing our variables of interest
  - A mapping of the variables with the graphical elements (aesthetics)
    - x: x-axis
    - y: y-axis

## Practical Excercise

5. Create data frame using df


## Slide with table

```{r, echo=t, fig.height=2.5,fig.width=4}
load("C:/Users/Anonymouse/CERNA Dropbox/Dennis Rickert/UJ Quant/IO_Introduction_main/my_df.Rdata")
my_df
```

To get the formula $profits = revenues - costs$, we type:

$$profits = revenues - costs$$ \## Slide with Plot

```{r pressure}
plot(pressure)
```

## Slide2 with Plot

```{r, echo=t, fig.height=2.5,fig.width=4}
# load("C:/Users/Anonymouse/CERNA Dropbox/Dennis Rickert/UJ Quant/IO_Introduction_main/my_df.Rdata")

year <- c(2001:2010)
revenues <- sample.int(100, 10)
costs <- sample.int(10, 10)

# gather fake vectors in data frame
my_df <- data.frame(year,revenues,costs)
```

## Slide3 with Plot

```{r, echo=t, fig.height=2.5,fig.width=4}
# load("C:/Users/Anonymouse/CERNA Dropbox/Dennis Rickert/UJ Quant/IO_Introduction_main/my_df.Rdata")

library(ggplot2)
ggplot() + 
  geom_line(data=my_df,
            mapping=aes(x=year, y=revenues))
```

Revenues of the `r nrow(my_df)` years from `r min(my_df$year)` through `r max(my_df$year)` lie between `r min(my_df$revenue)` and `r max(my_df$revenue)` with an average of `r mean(my_df$revenue)`
